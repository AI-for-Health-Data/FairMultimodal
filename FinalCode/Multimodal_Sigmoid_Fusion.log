Using device: cuda

--- Debug Info: Before Merge ---
Structured data shape: (33942, 173)
Unstructured data shape: (33942, 1053)
After filtering, number of rows: 33701
Computing aggregated text embeddings for each patient...
Aggregated text embeddings shape: (33701, 768)
Number of lab feature columns: 153

--- Demographics Hyperparameters ---
NUM_AGES: 75
NUM_GENDERS: 2
NUM_ETHNICITIES: 41
NUM_INSURANCES: 5
NUM_LAB_FEATURES (tokens): 153
Positive weight: 9.105247497558594
Positive weight: 10.0
[Epoch 1] Train Loss: 1.4198

--- Group-wise EDDI for Mortality (using demo branch output) ---
Age Buckets:
  15-29: 0.1126
  30-49: 0.0543
  50-69: 0.0235
  70-89: 0.0170
Mean EDDI across age groups (mortality): 0.051874285132892106

Ethnicity Groups:
  asian: 0.0521
  black: 0.3482
  hispanic: 0.1851
  others: 0.0006
  white: 0.1174
Mean EDDI across ethnicity groups (mortality): 0.140674649311448

Insurance Groups:
  insurance_0: 0.0274
  insurance_1: 0.0723
  insurance_2: 0.0135
  insurance_3: 0.0061
  insurance_4: 0.1343
Mean EDDI across insurance groups (mortality): 0.05072599099112148

Total EDDI for Mortality: 0.08109164181182053

--- Group-wise EDDI for Readmission (using demo branch output) ---
Age Buckets:
  15-29: 0.0455
  30-49: 0.0208
  50-69: 0.0020
  70-89: 0.0142
Mean EDDI across age groups (readmission): 0.020619656411955355

Ethnicity Groups:
  asian: 0.0042
  black: 0.0985
  hispanic: 0.0263
  others: 0.0000
  white: 0.0584
Mean EDDI across ethnicity groups (readmission): 0.037488165843432605

Insurance Groups:
  insurance_0: 0.0201
  insurance_1: 0.0049
  insurance_2: 0.0141
  insurance_3: 0.0165
  insurance_4: 0.0597
Mean EDDI across insurance groups (readmission): 0.02304845796578135

Total EDDI for Readmission: 0.02705209340705644
Metrics at threshold=0.5 after epoch 1: {'mortality': {'aucroc': 0.9112563605571251, 'auprc': 0.6200004599420427, 'f1': 0.43152024335482003, 'recall': 0.8932533733133433, 'precision': 0.2844728800611154}, 'readmission': {'aucroc': 0.5781029892827826, 'auprc': 0.10207134506102451, 'f1': 0.16458798540384512, 'recall': 1.0, 'precision': 0.08967359050445103}, 'eddi_mortality': {'age': {'subgroups': {'15-29': 0.11264980432589437, '30-49': 0.05430831032540731, '50-69': 0.023489604443822875, '70-89': 0.017049421436443883}, 'mean': 0.051874285132892106}, 'ethnicity': {'subgroups': {'asian': 0.05214407496341475, 'black': 0.3481935633606684, 'hispanic': 0.18510261207151196, 'others': 0.000550533351362148, 'white': 0.11738246281028272}, 'mean': 0.140674649311448}, 'insurance': {'subgroups': {'insurance_0': 0.02742505747050615, 'insurance_1': 0.0723148292017662, 'insurance_2': 0.013495631989692112, 'insurance_3': 0.006054851162381923, 'insurance_4': 0.134339585131261}, 'mean': 0.05072599099112148}, 'total': 0.08109164181182053}, 'eddi_readmission': {'age': {'subgroups': {'15-29': 0.04549491969546409, '30-49': 0.020795687207702074, '50-69': 0.0019662541026196885, '70-89': 0.01422176464203556}, 'mean': 0.020619656411955355}, 'ethnicity': {'subgroups': {'asian': 0.0041994312755641115, 'black': 0.09853967012191148, 'hispanic': 0.026294383301033022, 'others': 1.2776051721316531e-05, 'white': 0.058394568466933076}, 'mean': 0.037488165843432605}, 'insurance': {'subgroups': {'insurance_0': 0.02014527290283165, 'insurance_1': 0.004870456886403295, 'insurance_2': 0.014083073803988051, 'insurance_3': 0.016451977336158163, 'insurance_4': 0.0596915088995256}, 'mean': 0.02304845796578135}, 'total': 0.02705209340705644}}
[Epoch 2] Train Loss: 1.1643

--- Group-wise EDDI for Mortality (using demo branch output) ---
Age Buckets:
  15-29: 0.0392
  30-49: 0.0194
  50-69: 0.0152
  70-89: 0.0012
Mean EDDI across age groups (mortality): 0.018744777115476362

Ethnicity Groups:
  asian: 0.0497
  black: 0.4341
  hispanic: 0.1318
  others: 0.0006
  white: 0.1318
Mean EDDI across ethnicity groups (mortality): 0.1495802245859457

Insurance Groups:
  insurance_0: 0.0172
  insurance_1: 0.0237
  insurance_2: 0.0015
  insurance_3: 0.0120
  insurance_4: 0.0706
Mean EDDI across insurance groups (mortality): 0.024970104567643876

Total EDDI for Mortality: 0.06443170208968864

--- Group-wise EDDI for Readmission (using demo branch output) ---
Age Buckets:
  15-29: 0.0515
  30-49: 0.0242
  50-69: 0.0023
  70-89: 0.0211
Mean EDDI across age groups (readmission): 0.02476724251813681

Ethnicity Groups:
  asian: 0.0115
  black: 0.1409
  hispanic: 0.0113
  others: 0.0002
  white: 0.1036
Mean EDDI across ethnicity groups (readmission): 0.05348865342166205

Insurance Groups:
  insurance_0: 0.0309
  insurance_1: 0.0042
  insurance_2: 0.0184
  insurance_3: 0.0244
  insurance_4: 0.0160
Mean EDDI across insurance groups (readmission): 0.018779729628824054

Total EDDI for Readmission: 0.03234520852287431
Metrics at threshold=0.5 after epoch 2: {'mortality': {'aucroc': 0.9269798661230539, 'auprc': 0.6784726775969938, 'f1': 0.5727351916376306, 'recall': 0.7886056971514243, 'precision': 0.44964951273722004}, 'readmission': {'aucroc': 0.6015147046111796, 'auprc': 0.11794018459905226, 'f1': 0.1680795336130904, 'recall': 0.9874255459960292, 'precision': 0.09185778051408343}, 'eddi_mortality': {'age': {'subgroups': {'15-29': 0.03922140036367945, '30-49': 0.019360536517412, '50-69': 0.015203967428165854, '70-89': 0.0011932041526481543}, 'mean': 0.018744777115476362}, 'ethnicity': {'subgroups': {'asian': 0.0496507499640457, 'black': 0.4341102192967727, 'hispanic': 0.13177956140645466, 'others': 0.000581030856000826, 'white': 0.13177956140645466}, 'mean': 0.1495802245859457}, 'insurance': {'subgroups': {'insurance_0': 0.017166404969557, 'insurance_1': 0.023656268769142022, 'insurance_2': 0.0014726706045044685, 'insurance_3': 0.011993010848450147, 'insurance_4': 0.07056216764656574}, 'mean': 0.024970104567643876}, 'total': 0.06443170208968864}, 'eddi_readmission': {'age': {'subgroups': {'15-29': 0.05145108511875653, '30-49': 0.0242494900290348, '50-69': 0.0022669906809565155, '70-89': 0.021101404243799398}, 'mean': 0.02476724251813681}, 'ethnicity': {'subgroups': {'asian': 0.011511628177420453, 'black': 0.14089847320491553, 'hispanic': 0.01125091943162966, 'others': 0.0002024752410639003, 'white': 0.10357977105328067}, 'mean': 0.05348865342166205}, 'insurance': {'subgroups': {'insurance_0': 0.030932355305646586, 'insurance_1': 0.004168350574564425, 'insurance_2': 0.018362132654603885, 'insurance_3': 0.02443272461315198, 'insurance_4': 0.01600308499615339}, 'mean': 0.018779729628824054}, 'total': 0.03234520852287431}}
[Epoch 3] Train Loss: 1.1349

--- Group-wise EDDI for Mortality (using demo branch output) ---
Age Buckets:
  15-29: 0.0247
  30-49: 0.0201
  50-69: 0.0112
  70-89: 0.0011
Mean EDDI across age groups (mortality): 0.014302331023221313

Ethnicity Groups:
  asian: 0.0591
  black: 0.4213
  hispanic: 0.1574
  others: 0.0007
  white: 0.0747
Mean EDDI across ethnicity groups (mortality): 0.14263612692006394

Insurance Groups:
  insurance_0: 0.0239
  insurance_1: 0.0329
  insurance_2: 0.0026
  insurance_3: 0.0147
  insurance_4: 0.0314
Mean EDDI across insurance groups (mortality): 0.021110339792335356

Total EDDI for Mortality: 0.059349599245206865

--- Group-wise EDDI for Readmission (using demo branch output) ---
Age Buckets:
  15-29: 0.0749
  30-49: 0.0097
  50-69: 0.0119
  70-89: 0.0055
Mean EDDI across age groups (readmission): 0.025511099871187628

Ethnicity Groups:
  asian: 0.0096
  black: 0.4284
  hispanic: 0.1172
  others: 0.0000
  white: 0.0615
Mean EDDI across ethnicity groups (readmission): 0.12333045646272182

Insurance Groups:
  insurance_0: 0.0009
  insurance_1: 0.0387
  insurance_2: 0.0130
  insurance_3: 0.0242
  insurance_4: 0.0713
Mean EDDI across insurance groups (readmission): 0.029635706154844232

Total EDDI for Readmission: 0.05949242082958456
Metrics at threshold=0.5 after epoch 3: {'mortality': {'aucroc': 0.9276677902897987, 'auprc': 0.6974249947494119, 'f1': 0.5463366336633664, 'recall': 0.8272863568215892, 'precision': 0.40783444198078345}, 'readmission': {'aucroc': 0.9484045894931028, 'auprc': 0.5116724457492614, 'f1': 0.5888542478565861, 'recall': 1.0, 'precision': 0.4172880419773543}, 'eddi_mortality': {'age': {'subgroups': {'15-29': 0.024721684003945976, '30-49': 0.020142912567344788, '50-69': 0.011237344146841346, '70-89': 0.001107383374753141}, 'mean': 0.014302331023221313}, 'ethnicity': {'subgroups': {'asian': 0.05909745453573111, 'black': 0.4213228476252619, 'hispanic': 0.15735430474947631, 'others': 0.0007198875653366556, 'white': 0.07468614012451372}, 'mean': 0.14263612692006394}, 'insurance': {'subgroups': {'insurance_0': 0.023918056235381444, 'insurance_1': 0.032895717949067746, 'insurance_2': 0.0026395075456601544, 'insurance_3': 0.014728935548417924, 'insurance_4': 0.031369481683149514}, 'mean': 0.021110339792335356}, 'total': 0.059349599245206865}, 'eddi_readmission': {'age': {'subgroups': {'15-29': 0.07488683684297714, '30-49': 0.009713331305673827, '50-69': 0.011930836036858246, '70-89': 0.005513395299241288}, 'mean': 0.025511099871187628}, 'ethnicity': {'subgroups': {'asian': 0.009566906981880677, 'black': 0.4284284793595875, 'hispanic': 0.11716251761535164, 'others': 4.4114531660756466e-06, 'white': 0.06148996690362317}, 'mean': 0.12333045646272182}, 'insurance': {'subgroups': {'insurance_0': 0.0009417164709750373, 'insurance_1': 0.038748001114754155, 'insurance_2': 0.013005690931026185, 'insurance_3': 0.024207619917675, 'insurance_4': 0.07127550233979077}, 'mean': 0.029635706154844232}, 'total': 0.05949242082958456}}
[Epoch 4] Train Loss: 0.7841

--- Group-wise EDDI for Mortality (using demo branch output) ---
Age Buckets:
  15-29: 0.0178
  30-49: 0.0144
  50-69: 0.0189
  70-89: 0.0290
Mean EDDI across age groups (mortality): 0.020039182843062296

Ethnicity Groups:
  asian: 0.0373
  black: 0.0872
  hispanic: 0.0872
  others: 0.0004
  white: 0.0872
Mean EDDI across ethnicity groups (mortality): 0.05987848921127812

Insurance Groups:
  insurance_0: 0.0177
  insurance_1: 0.0112
  insurance_2: 0.0223
  insurance_3: 0.0271
  insurance_4: 0.0068
Mean EDDI across insurance groups (mortality): 0.01702669543239445

Total EDDI for Mortality: 0.03231478916224496

--- Group-wise EDDI for Readmission (using demo branch output) ---
Age Buckets:
  15-29: 0.0710
  30-49: 0.0081
  50-69: 0.0117
  70-89: 0.0051
Mean EDDI across age groups (readmission): 0.023977280193612532

Ethnicity Groups:
  asian: 0.0115
  black: 0.4333
  hispanic: 0.1076
  others: 0.0000
  white: 0.0524
Mean EDDI across ethnicity groups (readmission): 0.12098703491936184

Insurance Groups:
  insurance_0: 0.0032
  insurance_1: 0.0402
  insurance_2: 0.0124
  insurance_3: 0.0234
  insurance_4: 0.0822
Mean EDDI across insurance groups (readmission): 0.03226583215954441

Total EDDI for Readmission: 0.059076715757506254
Metrics at threshold=0.5 after epoch 4: {'mortality': {'aucroc': 0.9391267663935272, 'auprc': 0.7368332246332188, 'f1': 0.6485573173901742, 'recall': 0.7481259370314842, 'precision': 0.5723789860059647}, 'readmission': {'aucroc': 0.9521058172681063, 'auprc': 0.5468814233221926, 'f1': 0.6024458700882117, 'recall': 0.9943745863666446, 'precision': 0.43212539545585277}, 'eddi_mortality': {'age': {'subgroups': {'15-29': 0.01780028556677729, '30-49': 0.014449483102136295, '50-69': 0.018929335566383834, '70-89': 0.028977627136951758}, 'mean': 0.020039182843062296}, 'ethnicity': {'subgroups': {'asian': 0.03725822272384399, 'black': 0.08723424847565893, 'hispanic': 0.08723424847565893, 'others': 0.00043147790556978815, 'white': 0.08723424847565893}, 'mean': 0.05987848921127812}, 'insurance': {'subgroups': {'insurance_0': 0.01770768392994951, 'insurance_1': 0.01123859851195814, 'insurance_2': 0.022313177417987454, 'insurance_3': 0.02712337985842568, 'insurance_4': 0.0067506374436514666}, 'mean': 0.01702669543239445}, 'total': 0.03231478916224496}, 'eddi_readmission': {'age': {'subgroups': {'15-29': 0.07100118195322092, '30-49': 0.008121657262463652, '50-69': 0.011673084407210156, '70-89': 0.005113197151555402}, 'mean': 0.023977280193612532}, 'ethnicity': {'subgroups': {'asian': 0.011538501033942307, 'black': 0.43331091306541114, 'hispanic': 0.1076195790085146, 'others': 4.359146756175196e-05, 'white': 0.052422590021379334}, 'mean': 0.12098703491936184}, 'insurance': {'subgroups': {'insurance_0': 0.0031734133439762073, 'insurance_1': 0.04019150783330258, 'insurance_2': 0.012380878043144111, 'insurance_3': 0.02341873976900761, 'insurance_4': 0.08216462180829151}, 'mean': 0.03226583215954441}, 'total': 0.059076715757506254}}
[Epoch 5] Train Loss: 0.7303

--- Group-wise EDDI for Mortality (using demo branch output) ---
Age Buckets:
  15-29: 0.0176
  30-49: 0.0079
  50-69: 0.0189
  70-89: 0.0260
Mean EDDI across age groups (mortality): 0.01759729923650638

Ethnicity Groups:
  asian: 0.0332
  black: 0.0918
  hispanic: 0.0918
  others: 0.0004
  white: 0.0918
Mean EDDI across ethnicity groups (mortality): 0.061815314830421596

Insurance Groups:
  insurance_0: 0.0028
  insurance_1: 0.0063
  insurance_2: 0.0189
  insurance_3: 0.0250
  insurance_4: 0.0090
Mean EDDI across insurance groups (mortality): 0.012400866913253747

Total EDDI for Mortality: 0.030604493660060576

--- Group-wise EDDI for Readmission (using demo branch output) ---
Age Buckets:
  15-29: 0.0675
  30-49: 0.0071
  50-69: 0.0097
  70-89: 0.0032
Mean EDDI across age groups (readmission): 0.021883996797926845

Ethnicity Groups:
  asian: 0.0185
  black: 0.4373
  hispanic: 0.0998
  others: 0.0002
  white: 0.0450
Mean EDDI across ethnicity groups (readmission): 0.12015940883638729

Insurance Groups:
  insurance_0: 0.0019
  insurance_1: 0.0390
  insurance_2: 0.0123
  insurance_3: 0.0231
  insurance_4: 0.0768
Mean EDDI across insurance groups (readmission): 0.030603603240835497

Total EDDI for Readmission: 0.057549002958383215
Metrics at threshold=0.5 after epoch 5: {'mortality': {'aucroc': 0.9457035757955837, 'auprc': 0.7513778820229593, 'f1': 0.6480446927374302, 'recall': 0.782608695652174, 'precision': 0.5529661016949152}, 'readmission': {'aucroc': 0.9614981082587228, 'auprc': 0.6175250332671129, 'f1': 0.6104367672995124, 'recall': 0.9735274652547982, 'precision': 0.44461236209762733}, 'eddi_mortality': {'age': {'subgroups': {'15-29': 0.017584788001651735, '30-49': 0.007933300075557282, '50-69': 0.01889990465727519, '70-89': 0.025971204211541317}, 'mean': 0.01759729923650638}, 'ethnicity': {'subgroups': {'asian': 0.033172200148091496, 'black': 0.09184863603965529, 'hispanic': 0.09184863603965529, 'others': 0.0003584658850505942, 'white': 0.09184863603965529}, 'mean': 0.061815314830421596}, 'insurance': {'subgroups': {'insurance_0': 0.002800739865892855, 'insurance_1': 0.006326245510381266, 'insurance_2': 0.01893349159329722, 'insurance_3': 0.024973464375323603, 'insurance_4': 0.008970393221373784}, 'mean': 0.012400866913253747}, 'total': 0.030604493660060576}, 'eddi_readmission': {'age': {'subgroups': {'15-29': 0.06754510143179841, '30-49': 0.007087306505445391, '50-69': 0.009746158941435299, '70-89': 0.0031574203130282827}, 'mean': 0.021883996797926845}, 'ethnicity': {'subgroups': {'asian': 0.01850321673159269, 'black': 0.43730381353102254, 'hispanic': 0.09981527355300146, 'others': 0.00016753692393305664, 'white': 0.04500720344238677}, 'mean': 0.12015940883638729}, 'insurance': {'subgroups': {'insurance_0': 0.0018531038909889506, 'insurance_1': 0.039048521737910576, 'insurance_2': 0.012265045571934108, 'insurance_3': 0.023100685630487117, 'insurance_4': 0.07675065937285673}, 'mean': 0.030603603240835497}, 'total': 0.057549002958383215}}

Final evaluation and EDDI subgroup analysis:

--- Group-wise EDDI for Mortality (using demo branch output) ---
Age Buckets:
  15-29: 0.0176
  30-49: 0.0079
  50-69: 0.0189
  70-89: 0.0260
Mean EDDI across age groups (mortality): 0.01759729923650638

Ethnicity Groups:
  asian: 0.0332
  black: 0.0918
  hispanic: 0.0918
  others: 0.0004
  white: 0.0918
Mean EDDI across ethnicity groups (mortality): 0.061815314830421596

Insurance Groups:
  insurance_0: 0.0028
  insurance_1: 0.0063
  insurance_2: 0.0189
  insurance_3: 0.0250
  insurance_4: 0.0090
Mean EDDI across insurance groups (mortality): 0.012400866913253747

Total EDDI for Mortality: 0.030604493660060576

--- Group-wise EDDI for Readmission (using demo branch output) ---
Age Buckets:
  15-29: 0.0675
  30-49: 0.0071
  50-69: 0.0097
  70-89: 0.0032
Mean EDDI across age groups (readmission): 0.021883996797926845

Ethnicity Groups:
  asian: 0.0185
  black: 0.4373
  hispanic: 0.0998
  others: 0.0002
  white: 0.0450
Mean EDDI across ethnicity groups (readmission): 0.12015940883638729

Insurance Groups:
  insurance_0: 0.0019
  insurance_1: 0.0390
  insurance_2: 0.0123
  insurance_3: 0.0231
  insurance_4: 0.0768
Mean EDDI across insurance groups (readmission): 0.030603603240835497

Total EDDI for Readmission: 0.057549002958383215
Training complete.
